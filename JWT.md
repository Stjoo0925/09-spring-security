# 토큰 인증방식 (JWT)

### ✍️ 왜 토큰 방식을 사용해야 하는가?

> 기존 세션 방식의 문제점 -> 최근의 개발 트렌드인 서버를 따로 두는 방식으로 인해 템플릿 엔진을 사용하지않아 사용자 인증정보를 프론트엔드 서버로 가져갈 수 없게 되었다. ->
> 그래서 토큰방식으로 전환됨 ex) jwt 라이브러리

토큰은 특정 알고리즘으로 인해서 데이터와 키를 받아 토큰을 생성함 (주로 HS256 알고리즘을 사용함)
토큰은 해킹당해도 상관없는 데이터만 들어가 있어야함.
-이름, 회원번호, 등등

---

### ✍️ 토큰 방식의 구조
헤더(Header), 페이로드(Payload), 시그니처(Signature). 각각의 부분은 점(.)으로 구분됩니다.

1. 헤더(Header):

헤더는 토큰의 타입과 해싱 알고리즘을 정의합니다.
일반적으로 JSON 객체로 이루어져 있으며, Base64Url 인코딩되어 있습니다.

2. 페이로드(Payload):

페이로드는 토큰의 클레임(claims)들을 포함합니다.
클레임은 엔티티(주로 사용자)와 관련된 정보 또는 토큰 자체와 관련된 정보를 나타냅니다.
클레임에는 등록된 클레임(Registered claims), 공개 클레임(Public claims), 비공개 클레임(Private claims)이 있습니다.
페이로드도 JSON 객체로 구성되며, Base64Url 인코딩되어 있습니다.

3. 시그니처(Signature):

시그니처는 헤더와 페이로드를 합친 후 비밀 키를 사용해 서명한 것입니다.
이 과정은 JWT의 무결성을 보장하기 위해 사용됩니다.
생성 방법은 다음과 같습니다:
헤더와 페이로드를 Base64Url로 인코딩합니다.
인코딩된 헤더와 페이로드를 점(.)으로 연결합니다.
이 문자열에 대해 헤더에 지정된 알고리즘을 사용해 서명합니다.
이 서명을 Base64Url로 인코딩하여 결과 문자열의 끝에 추가합니다.

---

### ✍️ 토큰 방식에서 벡엔드 서버가 하는일

1. 사용자 인증:

사용자가 로그인할 때, 백엔드 서버는 사용자의 자격 증명(예: 사용자 이름과 비밀번호)을 검증합니다.
검증이 성공하면, 서버는 사용자 정보를 포함한 JWT를 생성합니다.
JWT는 비밀 키를 사용하여 서명되고 클라이언트에게 반환됩니다.

2. JWT 발급:

인증된 사용자가 요청을 보낼 때마다 JWT를 발급합니다.
JWT는 클라이언트에 의해 저장(예: 로컬 스토리지 또는 쿠키)되고, 이후 요청 시마다 헤더에 포함되어 서버로 전송됩니다.

3. 요청 인증 및 권한 부여:

클라이언트로부터 요청을 받을 때, 서버는 요청 헤더에 포함된 JWT를 검증합니다.
토큰의 유효성을 확인하고, 서명이 올바른지, 만료되지 않았는지 등을 검사합니다.
검증이 성공하면, 토큰에 포함된 사용자 정보를 기반으로 요청을 처리하고, 필요에 따라 권한을 부여합니다.

4. 사용자 정보 추출:

JWT는 사용자의 식별자 및 기타 정보를 포함하고 있으므로, 서버는 토큰을 디코딩하여 필요한 사용자 정보를 추출할 수 있습니다.
이를 통해 데이터베이스 조회를 최소화하고, 서버의 부하를 줄일 수 있습니다.

5. 권한 검사:

서버는 토큰에 포함된 클레임을 기반으로 사용자에게 특정 작업을 수행할 권한이 있는지 검사합니다.
예를 들어, 관리자 권한이 필요한 작업은 is_admin 클레임을 확인할 수 있습니다.

---

### Access Token & Refresh Token

1.1 Access Token
Access Token은 사용자에게 특정 자원에 대한 액세스를 부여하는 토큰입니다. 일반적으로 짧은 수명을 가지며, 클라이언트가 서버에 요청할 때마다 포함되어 전송됩니다.

1.2 특징

+ 짧은 수명: 일반적으로 몇 분에서 몇 시간 동안 유효합니다.
+ 역할: 특정 자원이나 API 엔드포인트에 대한 접근 권한을 부여합니다.
+ 포함 정보: 사용자 ID, 권한, 만료 시간 등 필요한 정보를 포함합니다.
+ 전송 위치: 주로 HTTP 헤더(예: Authorization: Bearer <Access Token>)에 포함되어 전송됩니다.

2.1 Refresh Token
Refresh Token은 Access Token의 수명이 만료되었을 때 새로운 Access Token을 발급받기 위해 사용됩니다. 일반적으로 더 긴 수명을 가지며, 클라이언트는 Refresh Token을 사용하여 새로운 Access Token을 요청합니다.

2.2 특징

+ 긴 수명: 일반적으로 며칠에서 몇 주, 심지어 몇 달 동안 유효합니다.
+ 역할: 새로운 Access Token을 발급받기 위한 인증 수단입니다.
+ 포함 정보: 일반적으로 Access Token보다 적은 정보를 포함하며, 서버에서만 검증될 수 있습니다.
+ 보안: Refresh Token은 클라이언트의 안전한 저장소(예: HttpOnly 쿠키 또는 안전한 스토리지)에 저장되어야 합니다.

---
